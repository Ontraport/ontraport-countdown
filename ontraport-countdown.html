<script>
    ( function(){

        var _SECOND = 1000,
            _MINUTE = _SECOND * 60,
            _HOUR = _MINUTE * 60,
            _DAY = _HOUR * 24;
        
        var element = Object.create( HTMLElement.prototype );

        var countdownActive = false,
            countdownTimeout;

        element.isActive = function(){
            return countdownActive;
        };

        element.startCountdown = function(){
            countdownActive = true;
            var poller = function( elem ) {
                return function(){
                    if ( elem.isActive() ) {
                        elem.updateDisplay();
                        countdownTimeout = setTimeout( poller, 1000 );
                    }
                };
            }( this );

            poller();
        };  

        element.stopCountdown = function(){
            countdownActive = false;
            clearTimeout( countdownTimeout );
        };

        element.updateDisplay = function(){
            var day = this.getAttribute( "day" ),
                month = this.getAttribute( "month" ),
                year = this.getAttribute( "year" );

            var today = new Date,
                now = +today,
                // new Date( year, month, day, hours, minutes, seconds, milliseconds );
                countdownDate = new Date( year || today.getFullYear(), ( month - 1 ) || today.getUTCMonth(), day || 0 );
                then = +countdownDate;


            if ( now > then ) {
                console.log( "redirect!!!" );
            } else {
                var duration = then - now,
                    elem,
                    newVal;

                // Update days display
                elem = this.querySelector( ".ce-days" );

                if ( elem ) {
                    newVal = Math.floor( duration / _DAY );
                    elem.innerText = newVal;
                    duration -= ( newVal * _DAY );
                }
                
                elem = this.querySelector( ".ce-hours" );

                if ( elem ) {
                    newVal = Math.floor( duration / _HOUR );
                    elem.innerText = newVal;
                    duration -= ( newVal * _HOUR );
                }

                elem = this.querySelector( ".ce-minutes" );

                if ( elem ) {
                    newVal = Math.floor( duration / _MINUTE );
                    elem.innerText = newVal;
                    duration -= ( newVal * _MINUTE );
                }

                elem = this.querySelector( ".ce-seconds" );
                if ( elem ) {
                    newVal = Math.floor( duration / _SECOND );
                    elem.innerText = newVal;
                    duration -= ( newVal * _SECOND );
                }
            }
        };


        // Fires when an instance of the element is created
        element.createdCallback = function(){
            this.updateDisplay();
            this.startCountdown();
        };
        
        // Fires when an instance was inserted into the document
        element.attachedCallback = function(){};
        
        // Fires when an instance was removed from the document
        element.detachedCallback = function(){};
        
        // Fires when an attribute was added, removed, or updated
        element.attributeChangedCallback = function( attr, oldVal, newVal ) {
            switch( attr ) {
                case "day":
                    console.log( "updating the day!" );
                break;
                case "month":
                    console.log( "updating the month!" );

                break;
                case "year":
                    console.log( "updating the year!" );

                break;
            }
        };
        

        // Registers custom element
        document.registerElement( 'ontraport-countdown', {
            'prototype': element
        } );
    }() );
</script>