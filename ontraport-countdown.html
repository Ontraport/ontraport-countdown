<script>
    ( function(){
        
        var element = Object.create( HTMLElement.prototype );

        var countdownActive = false,
            countdownTimeout;

        element.isActive = function(){
            return countdownActive;
        };

        element.startCountdown = function(){
            countdownActive = true;

            var poller = function( elem ) {
                return function(){
                    if ( elem.isActive() ) {
                        elem.updateDisplay();
                        countdownTimeout = setTimeout( poller, 1000 );
                    }
                };
            }( this );

            poller();
        };  

        element.stopCountdown = function(){
            countdownActive = false;
            clearTimeout( countdownTimeout );
        };

        var refreshCountdownDate = true;

        element.updateDisplay = function(){
            // CONSTANTS
            var _SECOND = 1000,
                _MINUTE = _SECOND * 60,
                _HOUR = _MINUTE * 60,
                _DAY = _HOUR * 24;

            // Current element attribute values
            var day, month, year,
                countdownDate, then;

            return function(){

                var today = new Date,
                    now = +today;

                if ( refreshCountdownDate ) {
                    day = this.getAttribute( "day" );
                    month = this.getAttribute( "month" );
                    year = this.getAttribute( "year" );

                    // new Date( year, month, day, hours, minutes, seconds, milliseconds );
                    countdownDate = new Date(
                        // YEAR
                        ( year || today.getFullYear() ),
                        // MONTH
                        ( month - 1 ) || today.getUTCMonth(),
                        // DAY
                        ( day || 0 )
                    );
                    
                    then = +countdownDate;

                    refreshCountdownDate = false;
                }

                if ( now > then ) {
                    console.log( "redirect!!!" );
                } else {
                    var duration = ( then - now ),
                        elem, newVal;

                    // Update days display
                    elem = this.querySelector( ".ce-days" );

                    if ( elem ) {
                        newVal = Math.floor( duration / _DAY );
                        elem.innerText = newVal;
                        duration -= ( newVal * _DAY );
                    }
                    
                    // Update hours display
                    elem = this.querySelector( ".ce-hours" );

                    if ( elem ) {
                        newVal = Math.floor( duration / _HOUR );
                        elem.innerText = newVal;
                        duration -= ( newVal * _HOUR );
                    }

                    // Update minutes display
                    elem = this.querySelector( ".ce-minutes" );

                    if ( elem ) {
                        newVal = Math.floor( duration / _MINUTE );
                        elem.innerText = newVal;
                        duration -= ( newVal * _MINUTE );
                    }

                    // Update seconds display
                    elem = this.querySelector( ".ce-seconds" );

                    if ( elem ) {
                        newVal = Math.floor( duration / _SECOND );
                        elem.innerText = newVal;
                        duration -= ( newVal * _SECOND );
                    }
                }
            };
        }();


        // Fires when an instance of the element is created
        element.createdCallback = function(){
            this.updateDisplay();
            this.startCountdown();
        };
        
        // Fires when an instance was inserted into the document
        element.attachedCallback = function(){};
        
        // Fires when an instance was removed from the document
        element.detachedCallback = function(){};
        
        // Fires when an attribute was added, removed, or updated
        element.attributeChangedCallback = function( attr, oldVal, newVal ) {
            switch( attr ) {
                case "day":
                case "month":
                case "year":
                refreshCountdownDate = true;
                break;
            }
        };
        

        // Registers custom element
        document.registerElement( 'ontraport-countdown', {
            'prototype': element
        } );
    }() );
</script>